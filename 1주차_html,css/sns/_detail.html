<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ë…¸ë³´ë…¸ì˜ SNS</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="wrap-container detail">
        <table class="table-container">
            <!-- í”„ë¡œí•„ ì‚¬ì§„, ì•„ì´ë”” -->
            <tr>
                <td>
                    <a href="main.html">
                        <div class="text-container">
                            <img src="/img/img_5.jpg" alt="">
                            <span>i_am_bonobono</span>
                        </div> 
                    </a>
                </td>
            </tr>
            <!-- ìƒì„¸ ì´ë¯¸ì§€ -->
            <tr class="datail-img">
                <td>
                    <img src="/img/img_1.webp" alt="">
                </td>
            </tr>
            <!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
            <tr>
                <td>
                    <button class="like-btn">ğŸ¤</button>
                </td>
            </tr>
            <!-- ëŒ“ê¸€ ì…ë ¥ -->
            <tr>
                <td>
                    <div class="input-container">
                        <input type="text">
                        <button class="write-btn">ì…ë ¥</button>
                    </div>
                </td>
            </tr>
            <!-- ëŒ“ê¸€ ê²°ê³¼ -->
            <tr>
                <td>
                    <div class="reply-container"></div>
                </td>
            </tr>   
        </table>
    </div>    

    <script>
    const urlParams = new URLSearchParams(window.location.search);
    const postId = Number(urlParams.get("id"));

    const posts = JSON.parse(localStorage.getItem("posts")) || [];
    const post = posts.find(p => p.id === postId);

    if (post) {
        // ì´ë¯¸ì§€ ë Œë”ë§
        const imgTd = document.querySelector(".datail-img td");
        imgTd.innerHTML = `<img src="${post.image}" alt="">`;

        // ë³¸ë¬¸ ë‚´ìš© ì¶”ê°€ (ì„ íƒ)
        const contentRow = document.createElement("tr");
        contentRow.innerHTML = `<td><p>${post.content}</p></td>`;
        document.querySelector(".table-container").insertBefore(contentRow, imgTd.parentNode.nextSibling);
    } else {
        alert("ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

    // ëŒ“ê¸€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´)
    let comments = JSON.parse(localStorage.getItem(`comments_${postId}`)) || [];

    function saveComments() {
    localStorage.setItem(`comments_${postId}`, JSON.stringify(comments));
    }

    const replyContainer = document.querySelector(".reply-container");
    const input = document.querySelector(".input-container input");
    const writeBtn = document.querySelector(".write-btn");

    // ëŒ“ê¸€ ëª©ë¡ ë Œë”ë§
    function renderComments() {
        replyContainer.innerHTML = "";
        comments.forEach((comment) => {
        const p = document.createElement("p");
        p.setAttribute("data-id", comment.id);

        const span = document.createElement("span");
        span.textContent = comment.text;

        const editBtn = document.createElement("button");
        editBtn.textContent = "ìˆ˜ì •";
        editBtn.onclick = () => editComment(comment.id);

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "ì‚­ì œ";
        deleteBtn.onclick = () => deleteComment(comment.id);

        p.appendChild(span);
        p.appendChild(editBtn);
        p.appendChild(deleteBtn);
        replyContainer.appendChild(p);
        });
    }

    // ëŒ“ê¸€ ì‘ì„±
    writeBtn.onclick = () => {
    const text = input.value.trim();
    if (!text) return;
    comments.push({ id: Date.now(), text });
    saveComments(); // ìˆ˜ì •ëœ ì €ì¥ í•¨ìˆ˜ ì‚¬ìš©
    input.value = "";
    renderComments();
    };

    // ëŒ“ê¸€ ì‚­ì œ
    function deleteComment(id) {
    comments = comments.filter(comment => comment.id !== id);
    saveComments();
    renderComments();
    }

    // ëŒ“ê¸€ ìˆ˜ì •
    function editComment(id) {
    const comment = comments.find(c => c.id === id);
    const p = document.querySelector(`p[data-id='${id}']`);
    const inputEdit = document.createElement("input");
    inputEdit.type = "text";
    inputEdit.value = comment.text;

    const saveBtn = document.createElement("button");
    saveBtn.textContent = "ì €ì¥";
    saveBtn.onclick = () => {
        comment.text = inputEdit.value;
        saveComments();
        renderComments();
    };

        // ìˆ˜ì • ì¤‘ì¸ ë¶€ë¶„ êµì²´
    p.innerHTML = "";
    p.appendChild(inputEdit);
    p.appendChild(saveBtn);
    }

    // ìµœì´ˆ ë Œë”ë§
    renderComments();
    </script>

</body>
</html>